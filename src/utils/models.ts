import { Reflect } from "./reflect.ts";
import {
  ColumnDescription,
  RelationDescription,
  FieldType,
} from "../models/fields.ts";

/**
   * Get all columns information
   */
export function getColumns(modelClass: any): ColumnDescription[] {
  if (!Reflect.hasMetadata("db:columns", modelClass.prototype)) {
    throw new Error("A model should have at least one column!");
  }

  return [
    {
      name: "id",
      propertyKey: "id",
      nullable: false,
      autoGenerated: true,
      select: true,
      type: FieldType.Number,
    },
    ...Reflect.getMetadata("db:columns", modelClass.prototype),
  ];
}

/**
   * Get all table relations information
   */
export function getRelations(modelClass: any): RelationDescription[] {
  return Reflect.hasMetadata("db:relations", modelClass.prototype)
    ? Reflect.getMetadata("db:relations", modelClass.prototype)
    : [];
}
